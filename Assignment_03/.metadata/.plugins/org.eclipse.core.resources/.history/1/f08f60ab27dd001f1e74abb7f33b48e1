import org.json.JSONArray;
import org.json.JSONObject;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.Scanner;

public class TumblrAPIClient {

    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);

        // Step 1: Get the blog name and post range from user input
        System.out.print("Enter the Tumblr blog name (e.g., 'good'): ");
        String blogName = scanner.nextLine();

        System.out.print("Enter the range (start-end) of posts: ");
        String range = scanner.nextLine();

        // Step 2: Construct the API URL for the blog
        String apiUrl = "https://good.tumblr.com/api/read/json?type=photo&num=50&start=0";

        // Call the method to fetch and process the API data
        fetchTumblrData(apiUrl, range);
    }

    private static void fetchTumblrData(String apiUrl, String range) {
        try {
            // Open a connection to the Tumblr API
        	System.out.println("Starting in function : ");
            HttpURLConnection connection = (HttpURLConnection) new URL(apiUrl).openConnection();
            connection.setRequestMethod("GET");
            connection.setConnectTimeout(5000);
            connection.setReadTimeout(5000);
            System.out.println("In between method : ");
            // Read the response from the API
            BufferedReader in = new BufferedReader(new InputStreamReader(connection.getInputStream()));
            StringBuilder response = new StringBuilder();
            String inputLine;

            while ((inputLine = in.readLine()) != null) {
                response.append(inputLine);
            }
            in.close();
//            System.out.println("response  : ");
//            System.out.println(response.toString());
            // The response is wrapped in 'var tumblr_api_read = ...', so we need to remove 'var tumblr_api_read = '
            String jsonResponseStr = response.toString();
            if (jsonResponseStr.startsWith("var tumblr_api_read = ")) {
                jsonResponseStr = jsonResponseStr.substring("var tumblr_api_read = ".length());
            }
            System.out.println(response.toString());
           // System.out.println(jsonResponseStr);
            // Parse the JSON response
            JSONObject jsonResponse = new JSONObject(jsonResponseStr);
            JSONObject blogData = jsonResponse.getJSONObject("tumblelog");
            
           // System.out.println(blogData);
            // Step 3: Extract basic blog info
            //String title = blogData.getString("title");
            //String description = blogData.getString("description");
            //int numPosts = blogData.getInt("posts");

//            System.out.println("title: " + title);
//            System.out.println("name: " + blogData.getString("name"));
//            System.out.println("description: " + description);
//            System.out.println("no of posts: " + numPosts);

            // Step 4: Process the specified range
//            String[] rangeParts = range.split("-");
//            int start = Integer.parseInt(rangeParts[0]);
//            int end = Integer.parseInt(rangeParts[1]);

            // Get the posts array
            JSONArray posts = jsonResponse.getJSONArray("posts");
            
            //System.out.println(posts.toString());
            	
            JSONObject post = posts.getJSONObject(0);
            JSONArray photos = post.getJSONArray("photos");
            JSONObject photo = photos.getJSONObject(0);
            String urlValue = photo.optString("photo-url-100");
            System.out.println(urlValue);
            

        } catch (Exception e) {
            e.printStackTrace();
        }
    }

}
